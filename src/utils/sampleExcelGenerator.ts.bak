import * as XLSX from 'xlsx';
import { saveAs } from 'file-saver';

// Sample data for creating an example Excel file
const createSampleExcelFile = () => {
  const workbook = XLSX.utils.book_new();

  // Info Sheet - Company Information
  const infoData = [
    ['ชื่อบริษัท', 'บริษัท เอบีซี เทรดดิ้ง จำกัด'],
    ['ประเภทบริษัท', 'บริษัทจำกัด'],
    ['งวดบัญชี', '2024'],
    ['เลขทะเบียน', '0105564000123'],
    ['ที่อยู่', '123 ถนนธุรกิจ กรุงเทพฯ 10110']
  ];
  
  const infoSheet = XLSX.utils.aoa_to_sheet(infoData);
  XLSX.utils.book_append_sheet(workbook, infoSheet, 'Info');

  // Trial Balance Sheet - Balance Sheet Accounts
  const trialBalanceData = [
    ['รหัสบัญชี', 'ชื่อบัญชี', 'เดบิต', 'เครดิต'],
    // สินทรัพย์หมุนเวียน
    ['1100', 'เงินสดและรายการเทียบเท่าเงินสด', 50000, 0],
    ['1200', 'ลูกหนี้การค้าและลูกหนี้อื่น', 75000, 0],
    ['1300', 'สินค้าคงคลัง', 30000, 0],
    ['1400', 'ค่าใช้จ่ายจ่ายล่วงหน้า', 5000, 0],
    // สินทรัพย์ไม่หมุนเวียน
    ['1600', 'อุปกรณ์', 100000, 0],
    ['1650', 'ค่าเสื่อมราคาสะสม - อุปกรณ์', 0, 20000],
    ['1700', 'อาคาร', 200000, 0],
    ['1750', 'ค่าเสื่อมราคาสะสม - อาคาร', 0, 40000],
    // หนี้สินหมุนเวียน
    ['2100', 'เจ้าหนี้การค้าและเจ้าหนี้อื่น', 0, 35000],
    ['2200', 'ค่าใช้จ่ายค้างจ่าย', 0, 8000],
    ['2300', 'เงินกู้ยืมระยะสั้น', 0, 25000],
    // หนี้สินไม่หมุนเวียน
    ['2600', 'เงินกู้ยืมระยะยาว', 0, 50000],
    // ส่วนของผู้ถือหุ้น
    ['3100', 'ทุนจดทะเบียน', 0, 100000],
    ['3200', 'กำไรสะสม', 0, 182000]
  ];
  
  const trialBalanceSheet = XLSX.utils.aoa_to_sheet(trialBalanceData);
  XLSX.utils.book_append_sheet(workbook, trialBalanceSheet, 'Trial Balance');

  // Trial PL Sheet - Profit & Loss Accounts
  const trialPLData = [
    ['รหัสบัญชี', 'ชื่อบัญชี', 'เดบิต', 'เครดิต'],
    // รายได้
    ['4100', 'รายได้จากการขาย', 0, 300000],
    ['4200', 'รายได้จากการให้บริการ', 0, 50000],
    // ต้นทุนขาย
    ['5000', 'ต้นทุนขาย', 180000, 0],
    ['5010', 'ซื้อสินค้า', 150000, 0],
    ['5020', 'ค่าขนส่งสินค้าเข้า', 5000, 0],
    // ค่าใช้จ่ายในการขาย (5300-5311)
    ['5300', 'เงินเดือนฝ่ายขาย', 15000, 0],
    ['5301', 'ค่าคอมมิชชั่นการขาย', 8000, 0],
    ['5302', 'ค่าโฆษณา', 12000, 0],
    ['5310', 'ค่าขนส่งสินค้าออก', 3000, 0],
    // ค่าใช้จ่ายในการบริหาร (5312-5350)
    ['5312', 'เงินเดือนฝ่ายบริหาร', 25000, 0],
    ['5320', 'ค่าเช่าสำนักงาน', 18000, 0],
    ['5325', 'ค่าสาธารณูปโภคสำนักงาน', 4000, 0],
    ['5330', 'วัสดุสำนักงาน', 2000, 0],
    ['5340', 'ค่าเบี้ยประกันภัย', 6000, 0],
    ['5345', 'ค่าธรรมเนียมวิชาชีพ', 8000, 0],
    // ค่าใช้จ่ายอื่น (5351-5359, 5365-5999)
    ['5351', 'ค่าเสื่อมราคา', 15000, 0],
    ['5352', 'ค่าใช้จ่ายหนี้สูญ', 2000, 0],
    ['5365', 'ค่าใช้จ่ายเบ็ดเตล็ด', 1000, 0],
    // ต้นทุนทางการเงิน (5360-5364)
    ['5360', 'ดอกเบี้ยจ่าย', 4000, 0],
    ['5361', 'ค่าธรรมเนียมธนาคาร', 500, 0]
  ];
  
  const trialPLSheet = XLSX.utils.aoa_to_sheet(trialPLData);
  XLSX.utils.book_append_sheet(workbook, trialPLSheet, 'Trial PL');

  return workbook;
};

// Function to download the sample file
export const downloadSampleExcelFile = () => {
  const workbook = createSampleExcelFile();
  const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
  const data = new Blob([excelBuffer], { 
    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' 
  });
  
  saveAs(data, 'Sample_Trial_Balance.xlsx');
};

// Multi-year example
const createMultiYearSampleExcelFile = () => {
  const workbook = XLSX.utils.book_new();

  // Info Sheet - Company Information
  const infoData = [
    ['ชื่อบริษัท', 'บริษัท เอ็กซ์วายแซด แมนูแฟคเจอริ่ง จำกัด'],
    ['ประเภทบริษัท', 'บริษัทจำกัด'],
    ['งวดบัญชี', '2024'],
    ['เลขทะเบียน', '0105564000456'],
    ['ที่อยู่', '456 ถนนอุตสาหกรรม กรุงเทพฯ 10120']
  ];
  
  const infoSheet = XLSX.utils.aoa_to_sheet(infoData);
  XLSX.utils.book_append_sheet(workbook, infoSheet, 'Info');

  // Trial Balance Sheet (Current Year)
  const trialBalanceData = [
    ['รหัสบัญชี', 'ชื่อบัญชี', 'เดบิต', 'เครดิต'],
    ['1100', 'เงินสดและรายการเทียบเท่าเงินสด', 80000, 0],
    ['1200', 'ลูกหนี้การค้าและลูกหนี้อื่น', 120000, 0],
    ['1510', 'สินค้าคงคลัง', 45000, 0], // หมายเหตุ: 1510 จะเรียกใช้การประมวลผลสินค้าคงคลัง
    ['1600', 'เครื่องจักร', 250000, 0],
    ['1650', 'ค่าเสื่อมราคาสะสม - เครื่องจักร', 0, 50000],
    ['2100', 'เจ้าหนี้การค้าและเจ้าหนี้อื่น', 0, 60000],
    ['2300', 'เงินกู้ยืมระยะสั้น', 0, 40000],
    ['2600', 'เงินกู้ยืมระยะยาว', 0, 80000],
    ['3100', 'ทุนจดทะเบียน', 0, 150000],
    ['3200', 'กำไรสะสม', 0, 115000]
  ];
  
  const trialBalanceSheet = XLSX.utils.aoa_to_sheet(trialBalanceData);
  XLSX.utils.book_append_sheet(workbook, trialBalanceSheet, 'Trial Balance');

  // Trial Balance 2 Sheet (Previous Year)
  const trialBalance2Data = [
    ['รหัสบัญชี', 'ชื่อบัญชี', 'เดบิต', 'เครดิต'],
    ['1100', 'เงินสดและรายการเทียบเท่าเงินสด', 60000, 0],
    ['1200', 'ลูกหนี้การค้าและลูกหนี้อื่น', 90000, 0],
    ['1510', 'สินค้าคงคลัง', 35000, 0],
    ['1600', 'เครื่องจักร', 250000, 0],
    ['1650', 'ค่าเสื่อมราคาสะสม - เครื่องจักร', 0, 25000],
    ['2100', 'เจ้าหนี้การค้าและเจ้าหนี้อื่น', 0, 45000],
    ['2300', 'เงินกู้ยืมระยะสั้น', 0, 30000],
    ['2600', 'เงินกู้ยืมระยะยาว', 0, 100000],
    ['3100', 'ทุนจดทะเบียน', 0, 150000],
    ['3200', 'กำไรสะสม', 0, 85000]
  ];
  
  const trialBalance2Sheet = XLSX.utils.aoa_to_sheet(trialBalance2Data);
  XLSX.utils.book_append_sheet(workbook, trialBalance2Sheet, 'Trial Balance 2');

  // Trial PL Sheet (Current Year)
  const trialPLData = [
    ['รหัสบัญชี', 'ชื่อบัญชี', 'เดบิต', 'เครดิต'],
    ['4100', 'รายได้จากการขาย', 0, 500000],
    ['5000', 'ต้นทุนขาย', 300000, 0],
    ['5010', 'ซื้อสินค้า', 280000, 0], // หมายเหตุ: 5010 พร้อมสินค้าคงคลังจะเรียกใช้การประมวลผลพิเศษ
    ['5300', 'ค่าใช้จ่ายในการขาย', 20000, 0],
    ['5312', 'ค่าใช้จ่ายในการบริหาร', 35000, 0],
    ['5360', 'ดอกเบี้ยจ่าย', 6000, 0]
  ];
  
  const trialPLSheet = XLSX.utils.aoa_to_sheet(trialPLData);
  XLSX.utils.book_append_sheet(workbook, trialPLSheet, 'Trial PL');

  // Trial PL 2 Sheet (Previous Year)
  const trialPL2Data = [
    ['รหัสบัญชี', 'ชื่อบัญชี', 'เดบิต', 'เครดิต'],
    ['4100', 'รายได้จากการขาย', 0, 420000],
    ['5000', 'ต้นทุนขาย', 250000, 0],
    ['5010', 'ซื้อสินค้า', 240000, 0],
    ['5300', 'ค่าใช้จ่ายในการขาย', 18000, 0],
    ['5312', 'ค่าใช้จ่ายในการบริหาร', 30000, 0],
    ['5360', 'ดอกเบี้ยจ่าย', 8000, 0]
  ];
  
  const trialPL2Sheet = XLSX.utils.aoa_to_sheet(trialPL2Data);
  XLSX.utils.book_append_sheet(workbook, trialPL2Sheet, 'Trial PL 2');

  return workbook;
};

// Function to download the multi-year sample file
export const downloadMultiYearSampleExcelFile = () => {
  const workbook = createMultiYearSampleExcelFile();
  const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
  const data = new Blob([excelBuffer], { 
    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' 
  });
  
  saveAs(data, 'Sample_Multi_Year_Trial_Balance.xlsx');
};
